## Installation and configuration
Create file `config/packages/yaroslavche_tdlib.yaml` with following content
```yaml
# config/packages/yaroslavche_tdlib.yaml

yaroslavche_tdlib:
  parameters:
    use_test_dc: true
    database_directory: "/var/tmp/tdlib"
    files_directory: "/var/tmp/tdlib"
    use_file_database: true
    use_chat_info_database: true
    use_message_database: true
    use_secret_chats: true
    api_id: 11111
    api_hash: 'abcdef1234567890abcdef1234567890'
    system_language_code: "en"
    device_model: "php"
    system_version: "7.2"
    application_version: "0.0.1"
    enable_storage_optimizer: true
    ignore_file_names: true
  client:
    encryption_key: ""
    default_timeout: 0.5
    auto_init: true
```
and install bundle with `composer`
```bash
composer require yaroslavche/tdlib-bundle
```

## Usage

### JsonClient
```php
use TDApi\LogConfiguration;
use Yaroslavche\TDLibBundle\TDLib\JsonClient;
use Yaroslavche\TDLibBundle\TDLib\Response\UpdateAuthorizationState;

LogConfiguration::setLogVerbosityLevel(LogConfiguration::LVL_FATAL_ERROR);
$tdlibParameters = [/** from config */];
$clientConfig = [/** from config */];
$client = new JsonClient($tdlibParameters, $clientConfig);

if ($clientConfig['auto_init'] === false)
{
    $client->initJsonClient();
}

var_dump($client->getOption('version'));

$authorizationStateResponse = $client->getAuthorizationState();
if ($authorizationStateResponse->getType() === UpdateAuthorizationState::AUTHORIZATION_STATE_WAIT_PHONE_NUMBER)
{
    $client->setAuthenticationPhoneNumber('+380991234567');
}
else if ($authorizationStateResponse->getType() === UpdateAuthorizationState::AUTHORIZATION_STATE_READY)
{
    var_dump($client->getMe());
}
```

### TDLib Service
Service provides `getJsonClient` method, which will return `Yaroslavche\TDLibBundle\TDLib\JsonClient`. Inject service and use as you need. For example:
```php
use Yaroslavche\TDLibBundle\Service\TDLib;

final class GetMeController
{
    /**
     * @Route("/getMe", name="getMe")
     */
    public function __invoke(TDLib $tdlib): Response
    {
        $tdlib->getJsonClient()->getMe();
    }
}
```

## Data Collector
With installed `symfony/profiler-pack`
 
![data_collector_image][data_collector_image]


[data_collector_image]:data:image/png;base64,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
